# chapter 1

作为一门学科，运维是很难的。不仅存在如何很好地运行系统这一普遍未解决的问题，而且已经发现的最佳实践是高度依赖环境的，而且远远没有得到广泛采用。还有一个很大程度上尚未解决的问题，即如何更好地运行运维团队。对这些问题的详细分析通常被认为起源于二战期间致力于改进盟军军事过程和产出的运筹学，但实际上，我们几千年来一直在思考如何更好地运作。

然而，尽管有这些努力和想法，可靠的生产操作依然是难以实现 --特别是在信息技术和软件可操作性领域。例如，在企业世界中，经常将运维视为成本中心，这使得有意义的结果改进即使不是不可能的，也是困难的。这种方式的极大的短视尚未得到广泛的理解,但对它的不满已经引发了一场如何组织我们在 IT 行业做的事情的革命。

那场革命源于试图去解决一系列共同的问题。这些问题的最新解决方案由两个独立的名称——devops 和 Site Reliability Engineering（SRE）提出。虽然我们单独地谈论它们，好像它们是对刚才描述的企业心态的完全不同的反应，但我们希望说服您，实际上它们比您想象的更相似，而且每种方法的实践者都有更多的共同点。

但首先，我们来了解一下它们各自的主要原则。

## DevOps 的背景

DevOps是一组松散的实践、指导方针和文化，旨在打破IT开发、运维、网络和安全性中的孤岛。由 John Willis, Damon Edwards 和 Jez Humble, CA(L) MS（代表文化，自动化，精益（在精益管理中）;(参见持续交付)、度量和共享是记住 DevOps 哲学要点的一个有用缩写。分享和协作是这一动作的中心。在DevOps方法中，您可以改进某些东西(通常是通过自动化）、度量结果并与同事共享这些结果，这样整个组织都可以改进。整个 CALMS 原则都是由支持性文化促成的。

DevOps、敏捷以及其他各种业务和软件再工程技术都是关于如何在现代世界中最好地开展业务的一般世界观的例子。DevOps 哲学中没有一个元素是可以轻易分离出来的，这基本上是通过设计实现的。然而，有几个关键的观点可以相对独立地讨论。

### 不再有孤立

第一个关键观点是不再有孤立，这是对几个想法的反应：

- 过去流行的、但现在越来越过时的独立运维与开发的团队安排
- 极端的知识孤岛化、纯粹的局部优化动机以及缺乏协作，在许多情况下都对业务产生了积极的负面影响

### 事故时正常的

第二个关键的观点是，事故不只是个人单独行动的结果，而是当事情不可避免地出错时，缺乏防范措施的结果。例如，一个糟糕的界面无意中鼓励了压力下的错误行为；如果(未明确说明的)错误情况发生，系统的错误特征使失败不可避免;不完善的监控使我们不可能知道是否出了问题，更不用说出了什么问题。一些传统观念更强的企业拥有根除犯错者并惩罚他们的文化本能。但这样做也有它自己的后果:最明显的是，它会促使人们混淆问题、隐瞒真相、指责他人，所有这些最终都是无益的干扰。因此，关注加速恢复比预防事故更有利。

### 改变应该是渐进的

第三个关键的观点是，变化最好是很小且频繁的。在变更委员会每月开会讨论对大型机配置进行更改的完整文档化计划的环境中逐渐改变，这是一个激进的想法。然而，这并不是一个新想法。所有更改都必须由有经验的人来考虑并批处理以便进行有效的考虑，这一概念或多或少与最佳实践背道而驰。更改是有风险的，但正确的响应是在可能的情况下将更改分割为更小的子组件。然后，在产品、设计和结构变化的常规输出之外，建立一个低风险变化的稳定管道。这种策略，再加上较小变更的自动测试和坏变更的可靠回滚，导致了变更管理的方法，如持续集成（CI）和持续交付或部署（CD）。

### 工具和文化是相互关联的

工具是 DevOps 的一个重要组成部分，尤其是在强调正确管理变更的情况下--今天，变更管理依赖于高度特定的工具。但是总的来说，DevOps 的支持者强烈强调组织文化而不是工具作为采用新工作方式成功的关键。一个好的企业文化可以代替工具，但是返回来很少成立。俗话说，文化吃策略当早餐（[culture eats strategy for breakfast](https://en.wikipedia.org/wiki/Normal_Accidents.)）。与运维一样，改变本身也是困难的。

### 测量是至关重要的

最后，度量在整个业务环境中尤其重要，例如，分解孤岛和事故解决。在每一种环境中，你都要通过客观的测量来确定正在发生的事情的真实性，验证你正在如你所期望的那样改变情况，并为不同职能的对话建立一个客观的基础。(这适用于业务和其他情况，如 on-call。)

## SRE 的背景

站点可靠性工程（SRE）是由谷歌的工程副总裁 Ben Treynor Sloss 创造的一个术语(以及相关的工作角色)。正如我们在前一节中看到的， DevOps 是一组关于操作和产品开发之间的全生命周期协作的广泛原则。SRE是一个工作角色，一组我们已经找到工作的实践(下面将描述)，以及一些激励这些实践的信念。如果您认为 DevOps 是一种哲学和一种工作方法，那么您可以认为 SRE 实现了 DevOps 所描述的一些哲学，并且比“ DevOps 工程师”更接近于工作或角色的具体定义。因此，在某种程度上，类 SRE 实现了接口 DevOps。

和 DevOps 不同，DevOps 起源于多个公司的领导者和实践者之间的合作，在 SRE 这个术语在整个行业广泛普及之前，谷歌的 SRE 从周围的公司继承了很多文化。考虑到这一轨迹，该规程作为一个整体，在默认情况下不会像DevOps那样引起文化变化。(当然，这并不意味着在任意组织中进行SRE是否需要文化变革。)SRE由以下具体原则定义。

### 运维是一个软件问题

SRE 的基本原则是，做好运维是一个软件问题。因此，SRE应该使用软件工程方法来解决这个问题。这是一个广泛的观点，涵盖了从流程和业务更改到类似复杂但更传统的软件问题的所有内容，例如重写堆栈以消除业务逻辑中的单点故障。

### 按服务水平目标管理（Service Level Objectives[SLOs]）

SRE 并不试图提供所有内容 100% 的可用性。正如我们在第一本书《现场可靠性工程》（Site Reliability Engineering）中所讨论的那样，这是一个错误的目标，原因有很多。相反，产品团队和 SRE 团队为服务及其用户群选择适当的可用性目标，并且按 SLO 进行服务管理。决定这样一个目标需要来自业务的强大协作。SLOs 也具有文化含义：作为涉众之间的协作决策，违反 SLO 的行为将团队带回了设计阶段，这是无可指责的。

### 尽量减少辛苦的工作

对于 SRE，任何手动的、结构上强制的操作任务都是令人讨厌的。（这并不意味着我们没有这样的业务:我们有很多这样的业务。我们就是不喜欢他们。）我们相信，如果一台机器可以执行一个想要的操作，那么通常就应该让机器来做这个事情。这是一种区别（也是一种价值），在其他组织中并不常见，在这些组织中，辛苦就是工作，而这就是你付钱给一个人去做的事情。对于在谷歌环境下的 SRE 来说，辛苦不是工作——它不能是工作。任何花在操作任务上的时间都意味着不是花在项目工作上的时间——项目工作是我们如何使我们的服务更加可靠和可伸缩。

然而，通过“生产的智慧”，执行操作任务确实为决策提供了重要的输入。这项工作通过提供来自给定系统的实时反馈，使我们能够坚守阵地。劳苦的来源需要明确，这样你才能将其最小化或消除。但是，如果您发现自己处于操作负载不足的状态，则可能需要更频繁地推出新特性和更改，以便工程师能够熟悉您支持的服务的工作


> 关于“生产的智慧”的注释:这里的智慧是指你从生产中运行的东西中获得的智慧——它实际上是如何运行的，以及软件实际上应该如何设计的混乱细节，而不是从实际情况中孤立出来的服务的白板视图。你得到的所有页面，团队得到的所有教训，等等，都是与现实的直接联系，应该为更好的系统设计和行为提供信息。

### 自动化今年的工作

这方面的真正工作是确定在什么条件下自动化什么，以及如何自动化。在谷歌中实践的 SRE 对于团队成员在辛苦工作上可以花费的时间有一个严格的限制，而不是产生持久价值的工程:50%。许多人认为这个限制是一个上限。事实上，把它看作是一个明确的声明和实现机制要有用得多，它可以采用基于工程的方法来解决问题，而不仅仅是一遍又一遍地苦干。当我们想到自动化和辛苦时，这个基准与它的运行方式之间存在着一种不直观且有趣的相互作用。随着时间的推移，SRE 团队最终将服务的所有功能都自动化，留下了无法自动化的东西（Murphy-Beyer效应）。在其他条件相同的情况下，除非采取其他行动，否则这将主导 SRE 团队的工作。在谷歌环境下，您可能倾向于添加更多的服务，最多达到仍然支持 50% 工程时间的限制，或者您在自动化方面非常成功，以至于您可以转而做一些完全不同的事情。

### 通过降低失败的成本来快速行动

SRE 参与的主要好处之一并不一定是增加了可靠性，尽管这显然会发生;它实际上是改进了产品开发的产出。为什么?减少常见故障的平均修复时间(MTTR)可以提高产品开发人员的开发速度，因为工程师不必在这些问题之后浪费时间和集中精力进行清理。这源于一个众所周知的事实:在产品生命周期中发现问题的时间越晚，修复它的成本就越高.SREs 专门负责改进不受欢迎的这种问题的发现，从而为整个公司带来好处。

### 与开发人员共享所有权

“应用程序开发”和“生产”(有时称为程序员和运维人员)之间的严格界限会适得其反。特别是如果运维作为费用中心的职责划分和分类导致权力不平衡或尊重及薪酬的不一致。

SREs 倾向于关注生产问题，而不是业务逻辑问题，但是当他们的方法带来软件工程工具来处理问题时，他们与产品开发团队共享技能集。一般来说，SRE 在他们所关心的服务的可用性、延迟、性能、效率、变更管理、监视、紧急响应和容量规划方面具有特殊的专业知识。这些特定的(通常定义良好的)能力是SRE为产品和相关产品开发团队所做工作的基础。理想情况下，产品开发和 SRE 团队都应该对技术栈有一个整体的视图——前端、后端、库、存储、内核和物理机器——任何团队都不应该嫉妒地拥有单个部分。事实证明，如果你的的界限是模糊的你可以完成更多，让 SREs 工具 JavaScript 或产品开发人员符合内核的要求:如何进行更改的知识和这样做的权限要广泛得多，嫉妒地保护任何特定功能的动机也被消除了。

在 Site Reliability Engineering 中，我们没有充分说明谷歌中的产品开发团队默认拥有他们的服务。虽然 SRE 原则仍然告知如何在整个谷歌中管理服务，但是对于大多数服务来说，SRE 既不可用也不可保证。当 SRE 团队与产品开发团队一起工作时，所有权模型最终也是一个共享模型。

### 使用相同的工具，而不管其功能或职位

工具是行为的一个非常重要的决定因素，如果认为在谷歌里 SRE 的有效性与可广泛访问的统一代码库、广泛的软件和系统工具阵列、高度优化和专有的生产堆栈等无关，那就太天真了。然而，我们与DevOps共享这个绝对的假设:不管团队在组织中扮演什么角色，负责服务的团队都应该使用相同的工具。没有一种好的方法来管理一个服务，该服务有一个针对 SREs 的工具，另一个针对产品开发人员的工具，在不同的情况下表现不同(可能是灾难性的)。这种分歧越大，您的公司从改进每个工具的每一项工作中获得的利益就越少。

### 比较和对比

看一下前面的原则，我们马上就会发现这些要点有许多共同之处:

- DevOps 和 SRE 都取决于一个共识--改进必然有修改。没有这些，就没有多少发挥的空间。

- 协作是 DevOps 工作的前沿和中心。有效的共享所有权模型和合作伙伴团队关系是 SRE 发挥作用所必需的。与 DevOps 一样，SRE 也具有跨组织共享的强大价值，这使得从基于团队的孤岛中爬出来稍微容易一些。

- 变更管理最好是作为小型的、持续的行动来进行，其中大多数都是理想的自动测试和应用的。变化与可靠性之间的关键交互作用使得这一点对于 SRE 尤为重要。

- 正确的工具非常重要，工具在一定程度上决定了行为的范围。然而，我们不能过于专注于某件事是否通过使用某些特定的工具实现;最后，面向系统管理的 API 是一种更重要的理念，它将比任何特定的实现都更持久。

- 度量绝对是 DevOps 和 SRE 如何工作的关键。对于SRE, SLOs 在决定为改进服务而采取的行动方面处于主导地位。当然，没有度量就不可能有 SLOs (以及跨团队的讨论——理想情况下是在产品、基础设施/ SRE 和业务之间)。对于 DevOps，度量行为通常用于理解流程的输出是什么，反馈循环的持续时间是什么，等等。DevOps 和 SRE 都是面向数据的东西，不管它们是专业还是理念。

- 管理生产服务的残酷现实意味着，糟糕的事情偶尔会发生，您必须说明原因。SRE 和 DevOps 都在进行无可指责的后期检查(postmortems)，以抵消无益的压力增加。

- 最终，实现 DevOps 或 SRE 是一个整体行为;他们都希望以一种高度具体的方式共同工作，从而使整个团队(或单元、或组织)变得更好。对于 DevOps 和 SRE 来说，更好的速度应该是结果。

正如您所看到的，DevOps 和 SRE 之间有许多共同点。

然而，两者之间也存在着显著的差异。DevOps 在某种意义上是一种更广泛的哲学和文化。因为它比 SRE 影响更广泛的更改，所以 DevOps 对环境更加敏感。DevOps 对于如何在详细级别上运行操作相对沉默。例如，它不是围绕服务的精确管理而规定的。相反，它选择专注于在更广泛的组织中打破障碍。这很有价值。

另一方面，SRE 的职责定义相对狭窄，其职责通常是面向服务的(和面向最终用户的)，而不是面向整个业务。因此，它为如何有效地运行系统带来了一个固执己见的知识框架(包括错误预算等共识)。虽然 SRE 作为一种职业，对激励及其影响有着高度的意识，但它对“孤岛化”和“信息壁垒”等话题却相对沉默。它支持 CI 和 CD 并不一定是因为业务案例，而是因为所涉及的改进的操作实践。或者，换句话说，SRE 与 DevOps 信仰相同的东西，但原因略有不同。

### 组织环境和促进成功的采用

DevOps 和 SRE 在概念上有很大的重叠。正如您可能期望的那样，它们也有一组相似的条件，这些条件必须在组织内是真实的，以便a)首先是可实现的，b)从该实现中获得最大利益。正如托尔斯泰几乎从未说过的，有效的操作方法都是相似的，而失败的方法都有各自的失败之处。动机在一定程度上可以解释为什么会这样。

如果一个组织的文化认可 DevOps 的方法的好处和愿意承担这些成本，成本通常表示为在招聘困难,所需要的能量保持在团队和责任,流动性,增加金融资源专用补偿一定更罕见的技能,然后,组织还必须确保正确的动机是为了实现这种方法的好处。

具体来说，以下内容应该在 DevOps 和 SRE 中都适用。

### 狭隘的，死板的激励会缩小你的成功

许多公司无意中定义了破坏集体绩效的正式激励措施。为了避免这种错误，不要将激励机制狭隘地局限于与发布相关或与可靠性相关的结果。正如任何一位经济学家都能告诉你的那样，如果有一个数字衡量标准，人们会找到一种方法来玩弄它，造成不好的影响，有时甚至是以一种完全善意的方式。相反，您应该允许您的员工自由地找到正确的权衡。正如前面所讨论的，DevOps 或 SRE 通常可以作为产品团队的加速器，允许软件组织的其他部分以持续和可靠的方式向客户交付特性。这种动态还解决了传统和不同的系统/软件组方法的一个持久问题:设计和生产之间缺乏反馈循环。具有早期SRE参与的系统(理想情况下，在设计时)通常在部署后的生产环境中工作得更好，不管谁负责管理服务。(没有什么比丢失用户数据更能减慢特性开发的速度了。)

### 你最好自己修理它;不要责怪别人

此外，避免将生产事故或系统故障的责任推卸给其他群体。在许多方面，推卸责任的动力是工程操作的传统模型的核心问题，因为分离的操作和软件团队允许单独的动机出现。相反，可以考虑采用以下方法在组织层面上对抗推卸责任:

- 不要只是允许，而是积极鼓励工程师在产品需要时更改代码和配置。还应允许这些小组在其任务范围内采取激进的行动，从而消除拖延行动的动机。

- 支持不带指责的事故检查报告。这样做可以消除淡化或掩盖问题的动机。这一步对于充分理解产品并实际优化其性能和功能至关重要，它依赖于前面提到的生产智慧。

允许支持从操作上无可救药的困难的产品中脱身。支持撤回的威胁会促使产品开发在支持准备阶段和产品本身得到支持时修复问题，从而节省每个人的时间。“无可救药的操作困难”的含义可能会因您的环境而有所不同——这里的动态应该是相互理解的责任之一。推迟其他组织可能是温和的，“我们认为拥有这种技能的人对时间有更高的价值利用”或者被框架所束缚，“如果他们的任务太多的操作工作，没有机会使用他们的工程技能集，他们会辞职”。在谷歌，直接从此类产品中撤出支持的做法已成为一种制度。

### 将可靠性工作视为一个专门的角色

在谷歌，SRE和产品开发是独立的组织。每个团队都有自己的关注点、优先级和管理，不需要听从其他团队的命令。然而，当产品成功时，产品开发团队通过雇佣新员工有效地为 SRE 的增长提供资金。这样，产品开发与 SRE 团队的成功有利害关系，就像 SREs 与产品开发团队的成功有利害关系一样。SRE 还有幸得到了高层管理人员的支持，这确保了工程团队对支持服务“SRE方式”的反对通常是短暂的。你不需要一个组织结构图来做不同的事情，你只需要一个不同的实践社区出现。

无论您是使用组织结构图还是使用更非正式的机制，都必须认识到专门化会带来挑战。DevOps和SRE的实践者受益于拥有一个支持和职业发展的同行社区，以及一个为他们提供独特技能和视角的工作阶梯。

需要注意的是，谷歌所采用的组织结构，以及前面提到的一些激励措施，在某种程度上依赖于一个相当大的组织。例如，如果您的20人创业公司只有一个(相对较小的)产品，那么允许撤回运维支持就没有多大意义了。采用 DevOps 风格的方法仍然是可能的，但是如果您所能做的只是帮助它增长，那么改进一个运维上很差的产品的能力就会被削弱。不过，通常情况下，在如何满足这些增长需求以及技术债务累积的速度方面，人们的选择比他们想象的要多。

### 什么时候可以代替是否

然而，当您的组织或产品增长超过一定规模时，您可以在支持什么产品或如何优先考虑该支持方面行使更多的自由。如果很明显，对系统X的支持要比对系统Y的支持早得多，那么隐式条件约束就可以发挥与在 SRE 世界中选择不支持服务相同的作用。

在谷歌，SRE 与产品开发的紧密合作已被证明是至关重要的:如果在您的组织中存在这样的关系，那么撤销(或提供)支持的决定可以基于关于比较操作特征的客观数据，从而避免在其他方面没有成效的对话。

SRE 和产品开发之间的有效关系还有助于避免组织的反模式，在这种模式中，产品开发团队必须在产品或功能完全准备好之前交付产品或功能。相反，SRE可以与开发团队合作，在维护的重担从最具专业知识的人身上转移开之前，对产品进行改进。

### 争取平等的尊重:事业和经济

最后，确保正确的职业激励是适当的:我们希望我们的DevOps/SRE组织和他们的产品开发同行一样受到尊重。因此，每个团队的成员应该以大致相同的方法进行评级，并拥有相同的财务激励。

## 结论

在许多方面，DevOps 和 SRE 在实践和理念上都非常接近于IT 运维的整体环境。

DevOps 和 SRE 都需要讨论、管理支持，并得到实际工作人员的支持，以取得重大进展。实现这两个目标都是一段旅程，而不是权宜之计:重命名和羞辱(换句话说，简单地重新命名一个团队 DevOps 或 SRE，而不改变他们组织的位置，这将不可避免地导致团队在没有得到承诺的改进时感到羞愧。)的做法是空洞的，不太可能带来好处。考虑到它是如何执行操作的更有见解的实现，SRE 对于如何在此过程中更早地更改您的工作实践提出了更具体的建议，尽管需要进行具体的调整。DevOps 关注的范围更广，因此比较难以推想和转化为具体步骤，但正是因为关注的范围更广，它可能会遇到较弱的初始阻力。


但是每个项目的实践者都使用许多相同的工具、相同的变更管理方法和相同的基于数据的决策思维。说到底，我们都面临着同样的问题:生产，并让它变得更好——不管我们被称作什么。

对于那些有兴趣进一步阅读的读者，以下建议将帮助您更广泛地理解目前正在发生的运营革命的文化、业务和技术基础:

- [Site Reliability Engineering](https://landing.google.com/sre/sre-book/toc/)

- [Effective DevOps](http://shop.oreilly.com/product/0636920039846.do)

- [The Phoenix PRoject](http://shop.oreilly.com/product/9780988262508.do)

- [The Practice of Cloud System Administration: DevOps and SRE Practices for Web Services, Volume 2](https://www.amazon.com/Practice-Cloud-System-Administration-Practices/dp/032194318X/ref=sr_1_1?ie=UTF8&qid=1527184188&sr=8-1&keywords=practice+of+cloud+system+administration)

- [Accelerate: The Science of Lean Software and DevOps](https://www.amazon.com/Accelerate-Software-Performing-Technology-Organizations/dp/1942788339/ref=sr_1_2?ie=UTF8&amp&qid=1515161455&amp&sr=8-2&amp&keywords=accelerate)




